<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Value Trade Table</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 10px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 10px;
            margin-bottom: 10px;
        }

        .table-container {
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
        }

        thead {
            position: sticky;
            top: 0;
            background: #667eea;
            color: white;
            z-index: 10;
        }

        th, td {
            padding: 4px 6px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 9px;
        }

        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        tbody tr:hover {
            background: #e9ecef;
        }

        .checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #667eea;
            margin-right: 4px;
        }

        .item-text {
            display: inline-block;
            min-width: 150px;
            padding: 2px 4px;
            border: 1px solid transparent;
            border-radius: 3px;
            cursor: text;
            font-size: 9px;
        }

        .item-text:focus {
            outline: none;
            border-color: #667eea;
            background: #f0f7ff;
        }

        .points-input {
            width: 50px;
            padding: 2px 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
            font-size: 9px;
            font-weight: 600;
            color: #667eea;
        }

        .points-input:focus {
            outline: none;
            border-color: #667eea;
            background: #f0f7ff;
        }

        .points {
            font-weight: 600;
            color: #667eea;
            text-align: center;
        }

        .stage {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 8px;
            font-weight: 600;
            color: white;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }

        .stage.discovery {
            background: #4CAF50;
        }

        .stage.qualification {
            background: #2196F3;
        }

        .stage.evaluation {
            background: #FF9800;
        }

        .stage.proposal {
            background: #9C27B0;
        }

        .stage.contract {
            background: #F44336;
        }

        .stage.closing {
            background: #00BCD4;
        }

        .summary {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .summary-label {
            font-weight: 600;
            color: #333;
        }

        .summary-value {
            font-weight: 700;
            color: #667eea;
        }

        .status {
            text-align: center;
            padding: 6px;
            background: #fff3cd;
            border-radius: 6px;
            font-weight: 600;
            color: #856404;
            margin-top: 8px;
            font-size: 10px;
        }

        .chart-container {
            background: white;
            padding: 10px;
            border-radius: 8px;
            height: 250px;
        }

        /* Modal/Popup Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-header h2 {
            color: #333;
            font-size: 18px;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 12px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .btn {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 200px;
            }
        }

        @media (max-width: 768px) {
            table {
                font-size: 9px;
            }
            
            th, td {
                padding: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>High Value Trade Table</h1>
        
        <div class="main-content">
            <div class="table-container">
                <table id="tradeTable">
                    <thead>
                        <tr>
                            <th>Order</th>
                            <th>Customer Ask</th>
                            <th>Points</th>
                            <th>Your Ask</th>
                            <th>Points</th>
                            <th>Stage</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div>
                <div class="summary">
                    <div class="summary-row">
                        <span class="summary-label">Total Gives:</span>
                        <span class="summary-value" id="totalGives">0</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Total Gets:</span>
                        <span class="summary-value" id="totalGets">0</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Points Left (Gives):</span>
                        <span class="summary-value" id="pointsLeftGives">210</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Points Left (Gets):</span>
                        <span class="summary-value" id="pointsLeftGets">210</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Delta:</span>
                        <span class="summary-value" id="delta">0</span>
                    </div>
                    <div class="status" id="status">Balanced Opportunity</div>
                </div>

                <div class="chart-container">
                    <canvas id="pointsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal/Popup -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Checkbox Details</h2>
                <span class="close" id="closeModal">&times;</span>
            </div>
            <form id="editForm">
                <div class="form-group">
                    <label for="editCheckboxLabel">Checkbox Label:</label>
                    <input type="text" id="editCheckboxLabel" placeholder="e.g., Checkbox 1">
                </div>
                <button type="submit" class="btn">Save Checkbox Label</button>
                <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
            </form>
        </div>
    </div>

    <script>
        // Data from Excel
        const tradeData = [
            { order: 1, gives: { checked: true, text: 'Sales materials', points: 1 }, gets: { checked: false, text: 'Direct Contact Information â€“ Full name, role/title, direct dial, and mobile number', points: 0 }, stage: 'Discovery' },
            { order: 2, gives: { checked: true, text: 'Case Study', points: 2 }, gets: { checked: false, text: 'Get Linkedin Connection', points: 0 }, stage: null },
            { order: 3, gives: { checked: true, text: 'NDA', points: 3 }, gets: { checked: false, text: 'NDA', points: 0 }, stage: null },
            { order: 4, gives: { checked: false, text: '"Ballpark" Pricing', points: 0 }, gets: { checked: false, text: 'Critical Business Issue Quantification ROI', points: 0 }, stage: 'Qualification' },
            { order: 5, gives: { checked: true, text: 'Competitive Comparison', points: 5 }, gets: { checked: false, text: 'Customer Goals and Obstacles', points: 0 }, stage: null },
            { order: 6, gives: { checked: false, text: 'Demo', points: 0 }, gets: { checked: false, text: 'Joint Evaluation Plan', points: 0 }, stage: null },
            { order: 7, gives: { checked: false, text: 'RoadMap', points: 0 }, gets: { checked: true, text: 'Budget/ Timelines/ Priorities Confirmed through discovery email', points: 7 }, stage: null },
            { order: 8, gives: { checked: true, text: 'Trial', points: 8 }, gets: { checked: false, text: 'Access to decision maker', points: 0 }, stage: null },
            { order: 9, gives: { checked: false, text: 'Extension of Trial', points: 0 }, gets: { checked: true, text: 'Committee members identified', points: 9 }, stage: null },
            { order: 10, gives: { checked: true, text: 'POC', points: 10 }, gets: { checked: true, text: 'Meet all committee members /stakeholders', points: 10 }, stage: 'Evaluation' },
            { order: 11, gives: { checked: false, text: 'Access to Executive Management', points: 0 }, gets: { checked: false, text: 'Buying Process and approval process documented', points: 0 }, stage: null },
            { order: 12, gives: { checked: false, text: 'Passes to Trade Show', points: 0 }, gets: { checked: false, text: 'Champion', points: 0 }, stage: 'Proposal' },
            { order: 13, gives: { checked: true, text: 'Legal discussion', points: 13 }, gets: { checked: false, text: 'Proposal Draft Submitted', points: 0 }, stage: null },
            { order: 14, gives: { checked: false, text: 'Redlines', points: 0 }, gets: { checked: false, text: 'Meeting to review and modify proposal', points: 0 }, stage: 'Contract' },
            { order: 15, gives: { checked: false, text: 'Payment Terms', points: 0 }, gets: { checked: false, text: 'Confirm purchase deadlines', points: 0 }, stage: 'Closing' },
            { order: 16, gives: { checked: false, text: 'References', points: 0 }, gets: { checked: false, text: 'Identify and meet legal contract', points: 0 }, stage: null },
            { order: 17, gives: { checked: false, text: 'Consulting', points: 0 }, gets: { checked: false, text: 'Redline Contract work confirmed with deadline', points: 0 }, stage: null },
            { order: 18, gives: { checked: false, text: 'Training /Onboarding', points: 0 }, gets: { checked: false, text: 'Implementation and Task Owners Documented', points: 0 }, stage: null },
            { order: 19, gives: { checked: false, text: 'Case Study', points: 0 }, gets: { checked: false, text: 'Signed Contract /PO', points: 0 }, stage: null },
            { order: 20, gives: { checked: false, text: 'Discount', points: 0 }, gets: { checked: false, text: 'Case study reference Agreed', points: 0 }, stage: null }
        ];

        let currentEditRow = null;
        let currentEditType = null; // 'gives' or 'gets'
        let currentCheckboxNumber = null;
        let currentCheckboxElement = null;
        let chart = null;
        let checkboxCounter = 0;
        let checkboxLabels = {}; // Store custom labels for checkboxes

        // Initialize table
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            checkboxCounter = 0;

            tradeData.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                // Get stage class for styling
                const stageClass = row.stage ? row.stage.toLowerCase().replace(/\s+/g, '-') : '';
                const stageDisplay = row.stage || '';
                
                tr.innerHTML = `
                    <td>${row.order}</td>
                    <td>
                        <input type="checkbox" class="checkbox" data-row="${index}" data-type="gives" data-checkbox-num="${++checkboxCounter}" ${row.gives.checked ? 'checked' : ''}>
                        <span class="item-text" contenteditable="true" data-row="${index}" data-type="gives">${row.gives.text}</span>
                    </td>
                    <td>
                        <input type="number" class="points-input" data-row="${index}" data-type="gives" value="${row.gives.points}" min="0" max="210">
                    </td>
                    <td>
                        <input type="checkbox" class="checkbox" data-row="${index}" data-type="gets" data-checkbox-num="${++checkboxCounter}" ${row.gets.checked ? 'checked' : ''}>
                        <span class="item-text" contenteditable="true" data-row="${index}" data-type="gets">${row.gets.text}</span>
                    </td>
                    <td>
                        <input type="number" class="points-input" data-row="${index}" data-type="gets" value="${row.gets.points}" min="0" max="210">
                    </td>
                    <td>
                        ${stageDisplay ? `<span class="stage ${stageClass}">${stageDisplay}</span>` : ''}
                    </td>
                `;
                
                tbody.appendChild(tr);
            });

            // Add event listeners to checkboxes - show popup when clicked
            document.querySelectorAll('.checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const rowIndex = parseInt(e.target.dataset.row);
                    const type = e.target.dataset.type;
                    const checkboxNum = e.target.dataset.checkboxNum;
                    
                    // Toggle checkbox state
                    const row = tradeData[rowIndex];
                    row[type].checked = e.target.checked;
                    
                    // Update points if needed
                    if (e.target.checked && row[type].points === 0) {
                        row[type].points = row.order;
                        const rowElement = e.target.closest('tr');
                        const pointsInput = rowElement.querySelector(`.points-input[data-type="${type}"]`);
                        if (pointsInput) {
                            pointsInput.value = row[type].points;
                        }
                    } else if (!e.target.checked) {
                        row[type].points = 0;
                        const rowElement = e.target.closest('tr');
                        const pointsInput = rowElement.querySelector(`.points-input[data-type="${type}"]`);
                        if (pointsInput) {
                            pointsInput.value = 0;
                        }
                    }
                    
                    updateSummary();
                    updateChart();
                    
                    // Open popup
                    openEditModal(rowIndex, type, checkboxNum);
                });
            });

            // Add event listeners to editable text fields
            document.querySelectorAll('.item-text').forEach(text => {
                text.addEventListener('blur', handleTextBlur);
                text.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        text.blur();
                    }
                });
            });

            // Add event listeners to points inputs
            document.querySelectorAll('.points-input').forEach(input => {
                input.addEventListener('change', handlePointsChange);
                input.addEventListener('blur', handlePointsChange);
            });

            updateSummary();
            updateChart();
        }


        function handleTextBlur(e) {
            const rowIndex = parseInt(e.target.dataset.row);
            const type = e.target.dataset.type;
            const newText = e.target.textContent.trim();
            
            if (tradeData[rowIndex] && tradeData[rowIndex][type]) {
                tradeData[rowIndex][type].text = newText;
            }
        }

        function handlePointsChange(e) {
            const rowIndex = parseInt(e.target.dataset.row);
            const type = e.target.dataset.type;
            const newPoints = parseInt(e.target.value) || 0;
            
            if (tradeData[rowIndex] && tradeData[rowIndex][type]) {
                tradeData[rowIndex][type].points = newPoints;
                // Update checkbox if points are set
                if (newPoints > 0) {
                    tradeData[rowIndex][type].checked = true;
                    const rowElement = e.target.closest('tr');
                    const checkbox = type === 'gives'
                        ? rowElement.querySelector('.checkbox[data-type="gives"]')
                        : rowElement.querySelector('.checkbox[data-type="gets"]');
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                } else {
                    tradeData[rowIndex][type].checked = false;
                    const rowElement = e.target.closest('tr');
                    const checkbox = type === 'gives'
                        ? rowElement.querySelector('.checkbox[data-type="gives"]')
                        : rowElement.querySelector('.checkbox[data-type="gets"]');
                    if (checkbox) {
                        checkbox.checked = false;
                    }
                }
            }
            
            updateSummary();
            updateChart();
        }


        function openEditModal(rowIndex, type, checkboxNum) {
            currentEditRow = rowIndex;
            currentEditType = type;
            currentCheckboxNumber = checkboxNum;
            
            // Get the checkbox element to store label
            const tbody = document.getElementById('tableBody');
            const rowElement = tbody.children[rowIndex];
            currentCheckboxElement = rowElement.querySelector(`.checkbox[data-checkbox-num="${checkboxNum}"]`);
            
            // Get or create checkbox label
            const checkboxKey = `checkbox_${checkboxNum}`;
            const defaultLabel = `Checkbox ${checkboxNum}`;
            const currentLabel = checkboxLabels[checkboxKey] || defaultLabel;
            
            // Set editable checkbox label
            document.getElementById('editCheckboxLabel').value = currentLabel;
            
            document.getElementById('editModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditRow = null;
            currentEditType = null;
            currentCheckboxNumber = null;
            currentCheckboxElement = null;
        }

        document.getElementById('closeModal').addEventListener('click', closeModal);
        document.getElementById('cancelBtn').addEventListener('click', closeModal);

        document.getElementById('editForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (currentCheckboxNumber !== null) {
                // Save the checkbox label
                const checkboxKey = `checkbox_${currentCheckboxNumber}`;
                const newLabel = document.getElementById('editCheckboxLabel').value.trim() || `Checkbox ${currentCheckboxNumber}`;
                checkboxLabels[checkboxKey] = newLabel;
                
                // The label is stored but not displayed in the table (since checkboxes don't show labels)
                // This is just for reference/storage purposes
                
                closeModal();
            }
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('editModal');
            if (e.target === modal) {
                closeModal();
            }
        });

        function updateSummary() {
            const totalGives = tradeData.reduce((sum, row) => sum + (row.gives.checked ? row.gives.points : 0), 0);
            const totalGets = tradeData.reduce((sum, row) => sum + (row.gets.checked ? row.gets.points : 0), 0);
            const maxPoints = 210;
            const pointsLeftGives = maxPoints - totalGives;
            const pointsLeftGets = maxPoints - totalGets;
            const delta = Math.abs(totalGives - totalGets);
            
            document.getElementById('totalGives').textContent = totalGives;
            document.getElementById('totalGets').textContent = totalGets;
            document.getElementById('pointsLeftGives').textContent = pointsLeftGives;
            document.getElementById('pointsLeftGets').textContent = pointsLeftGets;
            document.getElementById('delta').textContent = delta;
            
            const statusEl = document.getElementById('status');
            if (delta === 0) {
                statusEl.textContent = 'Balanced Opportunity';
                statusEl.style.background = '#d4edda';
                statusEl.style.color = '#155724';
            } else if (delta <= 10) {
                statusEl.textContent = 'Nearly Balanced Opportunity';
                statusEl.style.background = '#fff3cd';
                statusEl.style.color = '#856404';
            } else {
                statusEl.textContent = 'Unbalanced Opportunity';
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
            }
        }

        function updateChart() {
            const totalGives = tradeData.reduce((sum, row) => sum + (row.gives.checked ? row.gives.points : 0), 0);
            const totalGets = tradeData.reduce((sum, row) => sum + (row.gets.checked ? row.gets.points : 0), 0);
            const maxPoints = 210;
            const pointsLeftGives = maxPoints - totalGives;
            const pointsLeftGets = maxPoints - totalGets;
            
            const ctx = document.getElementById('pointsChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Total Gives', 'Total Gets', 'Points Left (Gives)', 'Points Left (Gets)'],
                    datasets: [{
                        label: 'Points',
                        data: [totalGives, totalGets, pointsLeftGives, pointsLeftGets],
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#4facfe'
                        ],
                        borderColor: [
                            '#5568d3',
                            '#6a3d8f',
                            '#d17ae8',
                            '#3d8fd6'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Points: ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: maxPoints,
                            ticks: {
                                stepSize: 20,
                                font: {
                                    size: 9
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 9
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize on page load
        renderTable();
    </script>
</body>
</html>

